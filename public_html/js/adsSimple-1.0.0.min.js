/*
 If you would like to read a full version of this program, you should access a following URL.
 http://ads.nicovideo.jp/assets/js/adsSimple-1.0.0.js
*/
var adsSimple=adsSimple||{};
(function(adsSimple){adsSimple.pathBase="http://ads.nicovideo.jp";adsSimple.version="1.0.0";var Class=adsSimple.Class={create:function(base){var key;var _class=function(){if(this.initialize)this.initialize.apply(this,arguments)};if(base)for(key in base)_class[key]=base[key];return _class}};var Utility=adsSimple.Utility={extend:function(base,implement){var key;for(key in implement)base[key]=implement[key]},toQueryString:function(object){var query="",key;for(key in object)query+=key+"="+encodeURIComponent(object[key])+
"&";return query.slice(0,query.length-1)}};var Advertisement=adsSimple.Advertisement=Class.create();Utility.extend(Advertisement.prototype,{zone:null,category:null,elementid:null,view:null,initialize:function(parameters){if(typeof parameters.zone!=="number")throw Error("zone is not number.");this.zone=parameters.zone;this.category=[].concat(parameters.category||[]);this.view=new View},getElement:function(){var element=document.getElementById(this.elementid);if(element)this.getElement=function(){return element};
return element},setElementId:function(elementid){if(!document.getElementById(elementid))throw Error(elementid+" is not found.");this.elementid=elementid},setAdvertisement:function(advertisement){Api.getAdvertisements(advertisement.zone,advertisement.category,function(response){advertisement.callback(response)})},set:function(elementid){this.setElementId(elementid);this.setAdvertisement(this);return this},callback:function(response){if(response.message)throw Error(response.message);this.view.display(this,
response.data.pop())}});var Api=adsSimple.Api=Class.create({count:0,prefix:"ads_callback",url:{OxBannerService:{getAdvertisements:"/api/OxBannerService/getAdvertisements.jsonp?",logImpression:"/api/OxBannerService/logImpression?"}},getAdvertisements:function(zone,category,callback){var _this=this;this.loadScript(adsSimple.pathBase+this.url.OxBannerService.getAdvertisements,{zone:zone,category:category.join(","),callback:_this.setCallback(callback)})},logImpression:function(bannerid,zoneid){this.loadScript(adsSimple.pathBase+
this.url.OxBannerService.logImpression,{bannerid:bannerid,zoneid:zoneid})},loadScript:function(url,parameters){var _document=document;var script=_document.createElement("script");script.src=url+Utility.toQueryString(parameters)+"&_="+(new Date).getTime();script.type="text/javascript";script.charset="utf-8";_document.getElementsByTagName("head")[0].appendChild(script)},setCallback:function(callback){var name=this.prefix+"_"+this.count++;window[name]=function(response){callback(response);window[name]=
undefined};return name}});var View=adsSimple.View=Class.create();Utility.extend(View.prototype,{display:function(advertisement,response){advertisement.getElement().innerHTML+=(new Template(advertisement,response)).getTag();Api.logImpression(response.bannerid,response.zoneid)}});var Template=adsSimple.Template=Class.create();Utility.extend(Template.prototype,{advertisement:null,response:null,bannertextVars:null,initialize:function(advertisement,response){this.advertisement=advertisement;this.response=
response;this.bannertextVars={}},getTag:function(){var _tag=null;if(this.isText())_tag=this.link(this.getBannertext());else if(this.isImage())_tag=this.link(this.getTagForImage());else if(this.isHtml())_tag=this.getTagForHtml();return _tag},getBannertext:function(){return this.response.bannertext||""},getTagForImage:function(){var template='<img src="%IMAGE_PATH%" alt="%BANNERTEXT%" border="0"/>';template=template.replace("%IMAGE_PATH%",this.getImagePath());template=template.replace("%BANNERTEXT%",
this.getBannertext());return template},getTagForHtml:function(){var template="";if(navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().indexOf("firefox")===-1)template='<iframe src="%TEXT_PATH%" vspace="0" hspace="0" marginwidth="0" marginheight="0" width="%WIDTH%" height="%HEIGHT%" frameborder="0" scrolling="no" allowTransparency="true" noresize></iframe>';else template='<object data="%TEXT_PATH%" vspace="0" hspace="0" marginwidth="0" marginheight="0" type="text/html" width="%WIDTH%" height="%HEIGHT%" border="0"></object>';
template=template.replace("%TEXT_PATH%",this.getBannertextPath());template=template.replace("%WIDTH%",this.getWidth());template=template.replace("%HEIGHT%",this.getHeight());return template},setBannertextVars:function(name,value){this.bannertextVars[name]=value},getImagePath:function(){return adsSimple.pathBase+"/assets/images/"+this.response.filename},getClickPath:function(){return adsSimple.pathBase+"/click?"+Utility.toQueryString({bannerid:this.response.bannerid,zoneid:this.response.zoneid})},
getBannertextPath:function(){return adsSimple.pathBase+"/bannertext?"+Utility.toQueryString({bannerid:this.response.bannerid,zoneid:this.response.zoneid})+"&"+Utility.toQueryString(this.bannertextVars)},getWidth:function(){return parseInt(this.response.width||0,10)>0?parseInt(this.response.width||0,10):this.advertisement.getElement().offsetWidth||0},getHeight:function(){return parseInt(this.response.height||0,10)>0?parseInt(this.response.height,10):this.advertisement.getElement().offsetHeight||0},
link:function(html){var template='<a href="%CLICK_PATH%" target="_blank">%HTML%</a>';template=template.replace("%CLICK_PATH%",this.getClickPath());template=template.replace("%HTML%",html);return template},isImage:function(){return this.response.contenttype==="gif"||this.response.contenttype==="jpeg"||this.response.contenttype==="png"},isText:function(){return this.response.contenttype==="txt"},isHtml:function(){return this.response.contenttype==="html"}})})(adsSimple);
